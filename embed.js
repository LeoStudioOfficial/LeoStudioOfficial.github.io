right:c.min([h.right,i.right])-j.left,bottom:c.min([h.bottom,i.bottom])-j.top,left:c.max([h.left,i.left])-j.left},l=(k.right-k.left)/10,m=(k.bottom-k.top)/10,n=k.left;n<k.right;n+=l)for(var o=k.top;o<k.bottom;o+=m){for(var p=a.document.elementFromPoint(n,o);p&&p.nodeType===e;){var q=b.getNodeStyle(p);if(b.hasLayout(p)||"block"===q.display||"none"!==q.clear)break;p=p.parentNode}p&&p.nodeType===e&&p!==this.node&&p!==this.root&&!b.isParentOf(p,this.node)&&(g.push(p),g.length>=f&&(n=k.right,o=k.bottom))}return g}},{key:"getWindowGeom",value:function(){var a=this.window.innerHeight||0,b=this.window.innerWidth||0,c=this.window.screenY||this.window.screenTop||0,d=c+a,e=this.window.screenX||this.window.screenLeft||0,f=e+b;return{t:c,r:f,b:d,l:e,w:b,h:a}}},{key:"getSelfGeom",value:function(){var a=b.getRect(this.node),d=b.getRect(this.ref),e=b.getNodeStyle(this.node),f=b.getWindowRect(this.node),g=a.width,h=a.height;this.ref!==this.root&&(g=c.max([0,c.min([a.right,d.right])-c.max([a.left,d.left])]),h=c.max([0,c.min([a.bottom,d.bottom])-c.max([a.top,d.top])]));var i=c.max([0,c.min(a.right,f.right)-c.max([a.left,f.left])]),j=c.max([0,c.min([a.bottom,f.bottom])-c.max([a.top,f.top])]),k=c.min([g,i]),l=c.min([h,j]),m=a.width?k/a.width:0,n=a.height?l/a.height:0,o=k*l/(a.width*a.height),p=1,q=this.getNodesOver(this.node,p);if(q.length){var r=b.getRect(q[0]),s=c.max([0,c.min([r.right,a.right])-c.max([r.left,a.left])]),t=c.max([0,c.min([r.bottom,a.bottom])-c.max([r.top,a.top])]);o=c.max([0,(k*l-s*t)/(a.width*a.height)])}var u=b.getScroll();return{t:a.top-u.y,r:a.right-u.x,b:a.bottom-u.y,l:a.left-u.x,z:e.zIndex,w:a.width,h:a.height,xiv:1===m?"1":Number(m).toFixed(2),yiv:1===n?"1":Number(n).toFixed(2),iv:1===o?"1":Number(o).toFixed(2)}}},{key:"getExpandGeom",value:function(){var a=b.getRect(this.ref),d=b.getRect(this.node),e=b.getWindowRect(this.node),f={top:c.max([a.top,e.top]),right:c.min([a.right,e.right]),bottom:c.min([a.bottom,e.bottom]),left:c.max([a.left,e.left])},g=b.getNodeOverflow(this.ref);return{t:c.max([0,d.top-f.top]),r:c.max([0,f.right-d.right]),b:c.max([0,f.bottom-d.bottom]),l:c.max([0,d.left-f.left]),xs:Boolean(g.yscroll),yx:Boolean(g.xscroll)}}},{key:"getGeom",value:function(){return{win:this.getWindowGeom(),self:this.getSelfGeom(),exp:this.getExpandGeom()}}}]),f}(),g={get:function(a){var b=new f(a);return b.getGeom()}};return g}(da,ba),fa=function(c){var d=I,e=L,f=D,g=X,h=ma,i=E,j=oa,l=Z,m=k,o=$,p=_,q=ia,r=aa.getOrigin,s=aa.getQuery,t=n,u=ea,v=e.extend({name:"ads",origin:b,onceEvents:{"view:enter":function(){this._reportLegacy({verb:"view",adverb:"0ms-no50perc"})},"view:iab":function(){this._reportLegacy({verb:"view",adverb:"iab-scroll"})}},events:{"frame:ready":function(a){this.forumId=a.forumId,this._reportLegacy({verb:"load",extra_data:a.extraData,advertisement_id:a.advertisement_id,provider:a.provider}),this.bindViewEvents(),this.triggerGeomUpdate()},"frame:resize":function(a){this.frame.setInlineStyle("height",a.height+"px"),0===a.height?this.trigger("ad-placement-empty"):this.trigger("ad-placement-filled"),this.triggerGeomUpdate()},"frame:click":function(){this._reportOnce({verb:"click"},"click")},"frame:hover":function(){this._reportOnce({verb:"hover"},"hover")},"frame:error-provider-not-ready":function(a){this._reportLegacy({verb:"fail",object_type:"provider",object_id:a.provider||this.getProvider(),adverb:"provider_not_ready"})},"frame:error-no-height":function(a){this._reportLegacy({verb:"fail",object_type:"provider",object_id:a.provider||this.getProvider(),adverb:"no_height"})},"frame:clearSandbox":function(){this.frame.elem.hasAttribute("sandbox")&&this.frame.elem.removeAttribute("sandbox")},"frame:$sf-init":function(){this.settings.isOnHostPage&&(this.isSafeframe=!0)},"frame:error":function(a){this.settings.isOnHostPage&&this.postMessageDirect({event:"error",data:{error:a}})}},constructor:function(){e.apply(this,arguments),this.origin=r(this.settings.adUrl),this._reportOnceHistory={},this.settings.isOnHostPage&&(this.detectLazyload=this.detectLazyload.bind(this),a.addEventListener("scroll",this.detectLazyload)),this.settings.useSourcelessFrame=this.settings.sourcelessIframe&&this.settings.isOnHostPage&&(!this.settings.defaultPlacementUrl||!this.settings.adBlockEnabled)},init:function(){if(this.settings.forum=p(s(this.settings.adUrl)).shortname,this.settings.forum){var b=this.settings.disableAds,c=this.settings.isInHome||this.settings.isOnHostPage&&0===a.location.href.indexOf(d.apps.home);if(!c&&b&&this.settings.canDisableAds)return void this.trigger("prevented-ad-load");this._reportOnce({verb:"call",object_type:"provider",object_id:this.getProvider(),adjective:1},"call"),this.settings.sandboxAds&&(this.sandbox=o.getAttribute({"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0,"allow-popups":!0})),e.prototype.init.call(this)}},detectLazyload:function(){if(this.frame&&this.settings.isOnHostPage){var b=this.frame.elem.getBoundingClientRect().top,c=b-a.innerHeight,d=a.innerHeight*this.settings.lazyloadViewports;c<d&&(this.postMessageDirect({event:"lazyload"}),a.removeEventListener("scroll",this.detectLazyload))}},getProvider:function(){if(this._provider)return this._provider;var a=this.settings.adUrl.match(/provider=(\w+)/);return a&&(this._provider=a[1]),this._provider},getUrl:function(){var b,c=this.settings;return b="inthreaddisqusadstxt"===c.experiment.experiment&&"active"===c.experiment.variant&&"inthread"===c.placement?a.document.location.href:c.isOnHostPage?c.url||a.document.location.href:c.url||c.referrer,q(c.adUrl,{anchorColor:l(c.anchorColor),colorScheme:c.colorScheme,sourceUrl:b,typeface:c.typeface,canonicalUrl:c.canonicalUrl,disqus_version:c.version,deviceWidth:c.deviceWidth,maxWidth:c.maxWidth})},triggerGeomUpdate:function(){if(this.frame.elem&&this.isSafeframe&&this.settings.isOnHostPage){var a=u.get(this.frame.elem);this.postMessageDirect({event:"geom-update",data:{geom:a}})}},bindViewEvents:function(){if(!this._viewEventsBound){this._viewEventsBound=!0,g.bindWindowEvents(!0);var a=this,b=function(b,c){a.postMessageDirect({event:b,percentViewable:c})},c=1e3,d=new j(function(){a.trigger("view:iab"),b("view:iab")},c),e=!1;this.listenTo(g({el:this.frame.elem}),{enter:function(){a.trigger("view:enter"),b("view:enter"),a.triggerGeomUpdate()},exit:function(){b("view:exit"),e&&(e=!1,b("view:50out"),d.clear()),a.triggerGeomUpdate()},visible:function(c,f){var g=h.visiblePercent(f,c.offset()),i=50;g>=i&&!e?(e=!0,b("view:50in"),d.start()):g<i&&e&&(e=!1,b("view:50out"),d.clear()),b("view",g),a.triggerGeomUpdate()}})}},postMessageDirect:function(a){this.frame.requiresWindow(function(a){var b=f.stringify(m({},a,{space:"disqus"}));i.postMessage(this.window,b,this.origin),i.postMessage(this.window,"disqus."+a.event,this.origin)})(a)},_report:function(c){var d=arguments.length>1&&arguments[1]!==b?arguments[1]:{},e=this.settings,f=d.provider||this.getProvider();c.forum_id=e.forumId||this.forumId;var g;g=e.placement&&e.placement.indexOf("timeline")>-1?"home":"recommendations"===e.placement?"recommendations":"embed";var h=d.usePOST?"reportJesterPOST":"reportJester";t[h](m({imp:e.impressionId,experiment:e.experiment.experiment,variant:e.experiment.variant,service:e.experiment.service,area:e.placement,product:g,forum:e.forum,zone:"thread",version:e.loaderVersion,page_url:e.referrer||a.document.location.href,page_referrer:e.hostReferrer||a.document.referrer,object_type:"advertisement",provider:f,event:"activity"},c))},_reportLegacy:function(a){var b=this.settings;this._report(m({ad_product_name:"iab_display",ad_product_layout:"iab_display",bin:"embed:promoted_discovery:"+b.experiment.service+":"+b.experiment.experiment+":"+b.experiment.variant,object_id:a.advertisement_id?"["+a.advertisement_id+"]":"",section:"default"},a))},_reportOnce:function(a,b){this._reportOnceHistory[b]||(this._reportLegacy(a),this._reportOnceHistory[b]=!0)},getFrameSettings:function(){var a=e.prototype.getFrameSettings.call(this);return a.insertBeforeEl=this.settings.insertBeforeEl,a.insertAfterEl=this.settings.insertAfterEl,a}}),w=function(a){return a=a||{},a.experiment||(a.experiment={experiment:a.experimentName,variant:a.experimentVariant,service:a.experimentService}),new v(a)};return{Ads:w}}({}),pa=function(c){var d=a.document,f=g,l=h,m=i,o=j,p=k,q=e,r=ia,s=n,t=x.HostConfig,u=y,v=Q,w=fa,z=new t(a);c.configAdapter=z;var A=[],B=function(a){return a.lastResizedHeight===b?parseInt(a.frame&&a.frame.elem&&a.frame.elem.style.height||0,10):a.lastResizedHeight},C=function(a){return parseInt(a.style.height||0,10)},D=!1,E=null,F=!1,G="disqus_recommendations",H=12,I=function(){for(var a;a=A.pop();)a.triggeredSlowEvent&&a.state!==a.constructor.states.RUNNING&&s.logStat("reset_embed.slow"),a.destroy()},J=c.reset=function(b){b=b||{},F&&!d.getElementById(G)&&(F=!1),I(),b.reload&&(F&&a.DISQUS_RECOMMENDATIONS&&a.DISQUS_RECOMMENDATIONS.reset(b),c.loadEmbed(b.config))},K=m(a),L=o(a),M=c.removeDisqusLink=function(){if(d.getElementsByClassName){if("complete"!==d.readyState)return a.addEventListener("load",M);var b=d.getElementsByClassName("dsq-brlink"),c=b&&b.length&&b[0];c&&c.parentNode.removeChild(c)}};c.VERSION="current",c.loadEmbed=function(a){if(A.length)return J({reload:!0}),u.log("Use DISQUS.reset instead of reloading embed.js please."),void u.log("See https://help.disqus.com/customer/portal/articles/472107-using-disqus-on-ajax-sites");z.configurator=a;var b=z.toJSON();b.version=c.VERSION,b.loaderVersion=s.getLoaderVersionFromUrl("https://c.disquscdn.com/next/embed/lounge.load.48980166e0153f33375a5a0d60b5e441.js"),D||(b.container.innerHTML="",D=!0),c.loadApps(b),c.removeDisqusLink()};var N=function(b){I();var c=v.Lounge(p({},b,{isHostIframed:K}));A.push(c),c.init();var d=function(a){c.whenFullyVisible(a)},e=Boolean(!b.adBlockEnabled||b.defaultPlacementUrl),f=function(a,c){return b.adBlockEnabled&&b.defaultPlacementUrl&&(a=r(b.defaultPlacementUrl,{position:c})),a},g="googlewidemargins"===b.experimentName&&"fallthrough"!==b.experimentVariant,h=null;if(b.topPlacementUrl&&e){b.topPlacementUrl=f(b.topPlacementUrl,"top");var i={};g&&(L?i.margin=b.experimentVariant+" auto":(i.margin=b.experimentVariant,i["min-width"]="calc(100% - "+2*parseInt(b.experimentVariant,10)+"px)")),h=w.Ads(p({adUrl:b.topPlacementUrl,placement:"top",isOnHostPage:!0,styles:i},b,{insertBeforeEl:c.frame.elem})),g&&h.once("ad-placement-empty prevented-ad-load",function(){this.frame.setInlineStyle("margin","0")}),A.push(h),d(function(){h.init()})}var j=null;if(b.bottomPlacementUrl&&e){b.bottomPlacementUrl=f(b.bottomPlacementUrl,"bottom");var k={};g&&(L?k.margin=b.experimentVariant+" auto":(k.margin=b.experimentVariant,k["min-width"]="calc(100% - "+2*parseInt(b.experimentVariant,10)+"px)")),j=w.Ads(p({adUrl:b.bottomPlacementUrl,placement:"bottom",isOnHostPage:!0,styles:k},b,{insertAfterEl:c.frame.elem})),g&&j.once("ad-placement-empty prevented-ad-load",function(){this.frame.setInlineStyle("margin","0")}),A.push(j),d(function(){j.init()})}if(K){var l=function(){var a=L?function(a,b){return C(b)+a}:function(a,b){return Math.max(C(b),a)};return H+Array.prototype.reduce.call(E.children,a,0)};c.on("frame:resize",function(b){var c=b.height||B(this);h&&(c+=B(h)),j&&(c+=B(j)),E&&(c+=l()),a.postMessage(JSON.stringify({scope:"host",sender:"dsq-app-embed",name:"resize",data:{height:c}}),"*")}),h&&c.listenTo(h,"frame:resize",function(b){var c=B(this)+(b.height||B(h));j&&(c+=B(j)),E&&(c+=l()),a.postMessage(JSON.stringify({scope:"host",sender:"dsq-app-embed",name:"resize",data:{height:c}}),"*")}),j&&c.listenTo(j,"frame:resize",function(b){var c=B(this)+(b.height||B(j));h&&(c+=B(h)),E&&(c+=l()),a.postMessage(JSON.stringify({scope:"host",sender:"dsq-app-embed",name:"resize",data:{height:c}}),"*")})}};return c.loadRecommendations=function(b,c){var e=b.container;if(e&&!d.getElementById(G)){E=d.createElement("div"),E.id=G,K&&a.addEventListener("message",function(b){var c,d;try{c=JSON.parse(b.data)}catch(e){return}var g=c.sender,h=q(E.children,g)&&E.children[g];if(h&&f.getHost(b.origin)===f.getHost(h.src)&&("resize"===c.name||"rendered"===c.name)){if(1===E.children.length)d=H+(c.data.height||0);else{var i=L?function(a,b){return b.id===g?c.data.height+a:C(b)+a}:function(a,b){return b.id===g?Math.max(c.data.height,a):Math.max(C(b),a)};d=H+Array.prototype.reduce.call(E.children,i,0)}d+=A.reduce(function(a,b){return a+B(b)},0),a.postMessage(JSON.stringify({scope:"host",sender:"dsq-app-embed",name:"resize",data:{height:d}}),"*")}});var g=e.parentNode;if(g&&"top"===c)E.style.cssText="margin-bottom: "+H+"px",g.insertBefore(E,e);else{if(!g||"bottom"!==c)return;E.style.cssText="margin-top: "+H+"px",g.insertBefore(E,e.nextSibling)}var h=a.disqus_recommendations_config;a.disqus_recommendations_config=function(){if(h)try{h.call(this)}catch(a){console.error("There was a problem with the Disqus configuration.",a)}this.disable_ads=b.disableAds,this.disable_loader=!0};var i=d.createElement("script");i.async=!0,i.id="dsq_recs_scr",i.src="https://"+b.forum+".disqus.com/recommendations.js",(d.head||d.body).appendChild(i),F=!0}},c.loadApps=function(a){a.adBlockEnabled===b?l(function(b){a.adBlockEnabled=b,N(a)}):N(a);var d=a.forumDetails||{},e=!!d.recommendationsEnabled&&d.recommendationsEnabled,f=d.recommendationsPlacement?d.recommendationsPlacement:null;e&&!F&&f&&"standalone"!==f&&c.loadRecommendations(a,f)},c}(pa),ga=function(b){var c=a.document,d=a.DISQUS||{},e=ja;d.reset||(d.reset=pa.reset),d.request||(d.request={}),d.request.get||(d.request.get=function(a,b,c){e(a,b,c)}),d.host||(d.host={}),d.host._loadEmbed||(d.host._loadEmbed=pa.loadEmbed),a.DISQUS=d;var f=function(a,b){var d=c.createElement("link");return d.rel="prefetch",d.as=b||"script",d.pr=1,d.href=a,c.head.appendChild(d),d};f("main.css","style"),f("https://c.disquscdn.com/next/embed/common.bundle.33bc87b2c4f9324203cc85b7dd1d0492.js"),f("https://c.disquscdn.com/next/embed/lounge.bundle.d295adc9f72a1145cb03cc5bc681e21c.js"),f("https://disqus.com/next/config.js")}({})}(this),this.DISQUS.host._loadEmbed();
